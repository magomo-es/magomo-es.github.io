<!-- 
VER =>=>=> https://xitrus.es/blog/112/Seleccionar_elementos_con_querySelector_de_JavaScript 
-->

<style>

* { padding: 0; margin: 0; box-sizing: border-box; }


.fixedBox {
    position: fixed;
    left: 0;
    top: 0; 
}

.transitionView { height: auto; max-height: 0px; overflow: hidden; transition: max-height 1s;  transition-delay: 0s; }

.heightThousand { max-height: 1000px !important; }

.containerPopupBox {
    border: 1px dotted;
	padding: 10px;
	width: max-content;
    background-color: #adf764e8;
    font-family: Arial, Helvetica, sans-serif;
}

.containerPopupButton { 
    position: relative;
    cursor: pointer; 
    padding: 5px; 
    border-radius: 0 0 5px 5px; 
    font-family: Arial, Helvetica, sans-serif; 
    font-size: 11px; 
    color: #fff; 
    box-shadow: 1px 1px 2px rgb(0, 0, 0);
}
.containerPopupButton:after { clear: both; }

.popupBoxText { 
	color: #3f8e3f;
	margin: 0 0 20px;
	font-family: Arial, Helvetica, sans-serif;
}

.popupBoxTitle { font-size: 24px; font-weight: bold; padding: 0 0 20px; margin: 0; }

.popupBoxButton { width: 100px; float: right; }

.gnrcFormBox { min-height: 30px; }

/* - - - - - - - - - - sortBy - - - - - - - - - - */

#controlInfoBox { background-color: #aabf14; float: left; z-index: 1; }

#informationMain { background-color: #adf764e8; padding-top: 35px; }

.infoFormInputRadio { float: left; padding: 3px; }

.informationLabel {float: left; text-align: right; width: auto; margin: 0; padding: 0px 5px; font-size: 11px; }

.informationFormBox { width: 150px; }

/* - - - - - - - - - - sortBy - - - - - - - - - - */

#controlSortBox { background-color: #1bac6f; float: left; z-index: 3; }

#sortByMain { background-color: #adf764e8; padding-top: 35px; }

.sortFormInputRadio { float: left; padding: 3px; }

.sortByLabel {float: left; text-align: right; width: auto; margin: 0; padding: 0px 5px; font-size: 11px; }

/* - - - - - - - - - - addPerson - - - - - - - - - - */

#controlAddBox { background-color: #43bd17; float: left; z-index: 2; }

#addPersonMain { background-color: #adf764e8; padding-top: 35px; }

.gnrcFormBox { min-height: 30px; }
.nameFormBox { width: 300px; }
.lastnameFormBox { width: 300px; }
.documentFormBox { width: 200px; }
.phoneFormBox { width: 200px; }
.birthdateFormBox { width: 200px; }

.addFormInputShort { float: right; width: 120px; padding: 3px; }
.addFormInputLong { float: right; width: 220px; padding: 3px; }

.addPersonLabel { float: left; text-align: right; width: 60px; margin: 0; padding: 3px 5px; font-size: 11px; }

/* - - - - - - - - - - Agenda List - - - - - - - - - - */

#agendaListTitle { margin: 50px 0 0; padding: 10px 20px; color: rgb(11, 11, 41); }

#agendaBox { margin: 0 0 0 20px; padding: 10px 20px; color: rgb(11, 11, 41); }

.itemPersonLi { width: max-content; font-family: Arial, Helvetica, sans-serif; color: #000; cursor: pointer; background-color: #fff; }

.itemPersonSelect { background-color: darkorange; }

</style>









<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Popup Boxes Open/Close Buttons => -->

<div id="popupButtonsBox" class="fixedBox" style="z-index: 99;">

    <div id="controlSortBox" class="containerPopupButton" data-id="1" data-text="Sort List" data-open="Open" data-opencolor="#1bac6f" data-close="Close" data-closecolor="#dd1385" data-box="sortByView" data-main="sortByBox" onclick="openFixBox(this)">Open Sort List</div>

    <div id="controlAddBox" class="containerPopupButton" data-id="2" data-text="Add Person" data-open="Open" data-opencolor="#43bd17" data-close="Close" data-closecolor="#dd1385" data-box="addPersonView" data-main="addPersonBox" onclick="openFixBox(this)">Open Add Person</div>

    <div id="controlInfoBox" class="containerPopupButton" data-id="3" data-text="Information" data-open="Open" data-opencolor="#aabf14" data-close="Close" data-closecolor="#dd1385" data-box="informationView" data-main="informationBox" onclick="openFixBox(this)">Open Information</div>

</div>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Popup Boxes Open/Close Buttons // -->

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Add Person Popup Box => -->

<div id="addPersonBox" class="fixedBox">

    <div id="addPersonView" class="transitionView">

        <div id="addPersonMain" class="containerPopupBox">

            <h2 class="popupBoxText popupBoxTitle">Insert Person into Agenda</h2>

            <div>

                <div class="gnrcFormBox nameFormBox">
                    <label class="popupBoxText addPersonLabel" for="theName">Nombres</label>
                    <input type="text" id="theName" name="theName" value="Mar" class="addFormInputLong" />
                </div>

                <div class="gnrcFormBox lastnameFormBox">
                    <label class="popupBoxText addPersonLabel" for="theLastname">Apellidos</label>
                    <input type="text" id="theLastname" name="theLastname" value="Gon" class="addFormInputLong" />
                </div>

            </div>

            <div>

                <div class="gnrcFormBox documentFormBox">
                    <label class="popupBoxText addPersonLabel" for="theDocument">DNI/NIE</label>
                    <input type="text" id="theDocument" name="theDocument" value="12345678Z" class="addFormInputShort" />
                </div>

                <div class="gnrcFormBox phoneFormBox">
                    <label class="popupBoxText addPersonLabel" for="thePhone">Teléfono</label>
                    <input type="phone" id="thePhone" name="thePhone" value="93210000" class="addFormInputShort" />
                </div>

                <div class="gnrcFormBox birthdateFormBox">
                    <label class="popupBoxText addPersonLabel" for="theBirthdate">F.Nacimiento</label>
                    <input type="date" id="theBirthdate" name="theBirthdate" class="addFormInputShort" />
                </div>

            </div>

            <button onclick="addPerson()" class="gnrcFormBox popupBoxButton">Agregar</button><div style="clear: both;"></div>

        </div>

    </div>

</div>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Add Person Popup Box // -->

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Sort By Popup Box => -->

<div id="sortByBox" class="fixedBox">

    <div id="sortByView" class="transitionView">

        <div id="sortByMain" class="containerPopupBox">

            <h2 class="popupBoxText popupBoxTitle">Select Sort Options</h2>

            <div style="margin: 10px 0; clear: both;">

                <label class="popupBoxText sortByLabel" for="sortupdate" checked>Registro</label><input type="radio" id="sortupdate" name="sortby" value="0" class="sortFormInputRadio" onchange="setSortByAgenda(this)" checked>
                <label class="popupBoxText sortByLabel" for="sortname">Nombre</label><input type="radio" id="sortname" name="sortby" value="1" class="sortFormInputRadio" onchange="setSortByAgenda(this)">
                <label class="popupBoxText sortByLabel" for="sortyearsold">Edad</label><input type="radio" id="sortyearsold" name="sortby" value="2" class="sortFormInputRadio" onchange="setSortByAgenda(this)">
                <div style="clear: both;"></div>

            </div>

            <div style="margin: 10px 0; clear: both;">

                <label class="popupBoxText sortByLabel" for="sortascn" checked>Ascendente</label><input type="radio" id="sortascn" name="sortdir" value="0" class="sortFormInputRadio" onchange="setSortDirAgenda(this)" checked>
                <label class="popupBoxText sortByLabel" for="sortdesc">Descendente</label><input type="radio" id="sortdesc" name="sortdir" value="1" class="sortFormInputRadio" onchange="setSortDirAgenda(this)">
                <div style="clear: both;"></div>

            </div>

            <button onclick="sortAgendaBy()" class="gnrcFormBox popupBoxButton">Ordenar</button><div style="clear: both;"></div>

        </div>

    </div>

</div>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Sort By Popup Box // -->

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Information Popup Box => -->

<div id="informationBox" class="fixedBox">

    <div id="informationView" class="transitionView">

        <div id="informationMain" class="containerPopupBox">

            <h2 class="popupBoxText popupBoxTitle">Information</h2>

            <div>

                <div class="informationFormBox popupBoxText">Personas <span id="infoitems">0</span></div>

                <div class="informationFormBox popupBoxText">Selected <span id="infoselected">0</span></div>

                <div class="informationFormBox popupBoxText">With DNI <span id="infodni">0</span></div>

            </div>

            <button onclick="updateInfo()" class="gnrcFormBox popupBoxButton">Update</button><div style="clear: both;"></div>

        </div>

    </div>

</div>

<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Information Popup Box // -->

<h1 id="agendaListTitle" class="popupBoxText">Agenda List</h1>

<ul id="agendaBox"></ul>


















<script>

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Popup Boxes functions & Vars =>

var popupBoxOpen = 0;

function openFixBox( theObj ) {
    if ( popupBoxOpen == 0 ) {
        popupBoxOpen = theObj.dataset.id;
        document.getElementById(theObj.dataset.box).classList.add('heightThousand');
        theObj.innerHTML = theObj.dataset.close + " " + theObj.dataset.text;
        theObj.setAttribute( "onClick", "closeFixBox(this)" );
        theObj.style.backgroundColor = theObj.dataset.closecolor;
    }
 }

 function closeFixBox( theObj ) {
    if ( popupBoxOpen == theObj.dataset.id ) {
        document.getElementById(theObj.dataset.box).classList.remove('heightThousand');
        theObj.innerHTML = theObj.dataset.open + " " + theObj.dataset.text;
        theObj.setAttribute( "onClick", "openFixBox(this)" );
        theObj.style.backgroundColor = theObj.dataset.opencolor;
        popupBoxOpen = 0;
    }
    
}

function updateInfo () {
    document.getElementById('infoitems').innerHTML = agendaBox.querySelectorAll('.itemPersonLi').length;
    document.getElementById('infoselected').innerHTML = agendaBox.querySelectorAll('*[data-select="1"]').length;
    document.getElementById('infodni').innerHTML = agendaBox.querySelectorAll('*[data-dni="1"]').length;
}

// - - - - - - - - - updateInfo(this) actualiza la informacion de info =>
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Popup Boxes functions & Vars //

var agendaAry = [];

var fullStringAgenda;

var controlSortBox = document.getElementById('controlSortBox');

var agendaBox = document.getElementById('agendaBox');

// - - - - - - - - - PERSON OBJECT FUNCTIONS =>

var getFullName = function() { return this.theName + " " + this.theLastname; }

var getFullData = function() { return this.theName + " " + this.theLastname + " - " + ((this.isDNI)?'DNI ':'NIE ') + this.theDNI + " - Tel. " + this.thePhone + " - Nacimiento " + this.Birthdate(); }

var getBirthdate = function() { 
    dias = [ "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo" ];
    meses = [ "enero", "febrero", "marzo", "abril", "mayo", "junio", "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre" ];
    return dias[this.theBirthdate.getDay()] + ", " + this.theBirthdate.getDate() + " de " +  meses[this.theBirthdate.getMonth()] + " de " + this.theBirthdate.getFullYear();
 }

var getYearsold = function() { return parseInt( parseInt( ( (new Date()).getTime() - this.theBirthdate.getTime() ) / 31557600 ) / 1000 ); }

// - - - - - - - - - PERSON OBJECT FUNCTIONS //

// - - - - - - - - - sortAgendaBy() ordena agenda por opciones 0.sortyearsold/1.sortname/2.sortupdate & 0.sortascn/1.sortdesc =>

function setSortByAgenda( theObj ) { controlSortBox.dataset.sortby = theObj.value; }

function setSortDirAgenda( theObj ) { controlSortBox.dataset.sortdir = theObj.value; }

function sortAgendaBy() {

    var sortFunction;

    // agendaAry => theName, theLastname, theDNI, dniNumber, dniControl, isDNI, thePhone, theBirthdate, theUpdate, fullName(), fullData(), Birthdate(), Yearsold()

    switch ( controlSortBox.dataset.sortby ) {
        case '0': // SortBy theUpdate
            if ( controlSortBox.dataset.sortdir == '0' ) {
                sortFunction = function ( a, b ) { let retu = 0; if (a.theUpdate>b.theUpdate) { retu = 1; } else if (a.theUpdate<b.theUpdate) { retu = -1; } return retu; }; 
            } else {
                sortFunction = function ( a, b ) { let retu = 0; if (a.theUpdate<b.theUpdate) { retu = 1; } else if (a.theUpdate>b.theUpdate) { retu = -1; } return retu; }; 
            }
        break;
        case '1': // SortBy theUpdate
            if ( controlSortBox.dataset.sortdir == '0' ) {
                sortFunction = function ( a, b ) { let retu = 0; if (a.fullName()>b.fullName()) { retu = 1; } else if (a.fullName()<b.fullName()) { retu = -1; } return retu; }; 
            } else {
                sortFunction = function ( a, b ) { let retu = 0; if (a.fullName()<b.fullName()) { retu = 1; } else if (a.fullName()>b.fullName()) { retu = -1; } return retu; }; 
            }
        break;
        case '2': // SortBy theUpdate
            if ( controlSortBox.dataset.sortdir == '0' ) {
                sortFunction = function ( a, b ) { let retu = 0; if (a.Yearsold()>b.Yearsold()) { retu = 1; } else if (a.Yearsold()<b.Yearsold()) { retu = -1; } return retu; }; 
            } else {
                sortFunction = function ( a, b ) { let retu = 0; if (a.Yearsold()<b.Yearsold()) { retu = 1; } else if (a.Yearsold()>b.Yearsold()) { retu = -1; } return retu; }; 
            }
        break;
    }

    console.log('sortAgendaBy => sortFunction: ' + sortFunction );

    agendaAry.sort( sortFunction );

    showAgenda();

}

// - - - - - - - - - sortAgendaBy() ordena agenda por opciones 0.sortyearsold/1.sortname/2.sortupdate & 0.sortascn/1.sortdesc =>

// - - - - - - - - - showAgenda() genera contenidos de ListaAgenda =>

function showAgenda () {

    agendaBox.innerHTML = "";

    agendaAry.forEach( createPersonaRow );

}

// - - - - - - - - - showAgenda() genera contenidos de ListaAgenda //

// - - - - - - - - - createPersonaRow() genra LI element =>

function createPersonaRow ( value, index, array ) {

    var liElement = document.createElement('li');

    liElement.classList.add('itemPersonLi');

    liElement.setAttribute( 'data-years', value.Yearsold() );

    liElement.setAttribute( 'data-dni', ((value.isDNI)?1:0) );

    liElement.setAttribute( 'data-select', 0 );

    liElement.setAttribute( 'onClick', 'selectRow(this)' );

    liElement.innerHTML = value.fullData() + '<button onclick="delPerson(\'' + index + '\')" style="margin-left: 20px;">Delete</button>';  

    agendaBox.appendChild( liElement );

}

// - - - - - - - - - createPersonaRow() genra LI element //

// - - - - - - - - - selectRow(this) selecciona fila asignando data-select & modificando el background =>

function selectRow ( theObj ) {

    if ( theObj.dataset.select == 0 ) {

        theObj.dataset.select = 1;
        theObj.classList.add('itemPersonSelect');

    } else {

        theObj.dataset.select = 0;
        theObj.classList.remove('itemPersonSelect');

    }

}

// - - - - - - - - - selectRow(this) selecciona fila asignando data-select & modificando el background //

// - - - - - - - - - delPerson( theIndex ) - Elimina elemento de array =>

function delPerson( theIndex ) {

    console.log("Elimina " + theIndex + " - " + agendaAry[theIndex].fullData() );

    delete agendaAry[theIndex];

    showAgenda();

}

// - - - - - - - - - delPerson( theIndex ) - Elimina elemento de array //

// - - - - - - - - - addPerson() - Agrega elemento en array =>

function addPerson() {

    isOK = true;
    errorMsg = "";
    var theNameObj = document.getElementById('theName');
	var theLastnameObj = document.getElementById('theLastname');
	var theDocumentObj = document.getElementById('theDocument');
	var thePhoneObj = document.getElementById('thePhone');
    var theBirthdateObj = document.getElementById('theBirthdate');

    if ( theNameObj.value.trim().length == 0 ) { errorMsg += ((errorMsg.length>0)?', ':'') + 'no name'; isOK = false; }
    if ( theLastnameObj.value.trim().length == 0 ) { errorMsg += ((errorMsg.length>0)?', ':'') + 'no lastname'; isOK = false; }
    if ( theDocumentObj.value.trim().length == 0 ) { errorMsg += ((errorMsg.length>0)?', ':'') + 'no document'; isOK = false; }
    if ( theBirthdateObj.value.trim().length == 0 ) { errorMsg += ((errorMsg.length>0)?', ':'') + 'no birthdate'; isOK = false; }

    if (isOK) {

        let resultDNI = controlDNI( theDocumentObj.value );

        let tmpBirthdate = theBirthdateObj.value.trim().split('-');

        let theBirthdate = new Date();
        theBirthdate.setDate( parseInt(tmpBirthdate[2]) );
        theBirthdate.setMonth( parseInt(tmpBirthdate[1]-1) );
        theBirthdate.setFullYear( parseInt(tmpBirthdate[0]) );
        theBirthdate.setHours( 12 );
        theBirthdate.setMinutes( 0 );

        let actualTimestamp = ( (new Date()).getTime() / 1000 ).toFixed(0);

        agendaAry.push( { theName: theNameObj.value, theLastname: theLastname.value, theDNI: theDocumentObj.value, dniNumber: resultDNI.number, dniControl: resultDNI.control, isDNI: resultDNI.isdni, thePhone: thePhoneObj.value, theBirthdate: theBirthdate, theUpdate: actualTimestamp, fullName: getFullName, fullData: getFullData, Birthdate: getBirthdate, Yearsold: getYearsold } );

        showAgenda();

        console.log( JSON.stringify(agendaAry) );

    } else { 
        
        console.log( 'Error: ' + errorMsg ); 

    }

}

// - - - - - - - - - addPerson() - Agrega elemento en array //

// - - - - - - - - - controlDNI( theDocument ) - Gerenra control de documento: caracter, tipo y numero =>

function controlDNI( theDocument ) {

    var tmpString = theDocument.trim(); 
    var theValueString = ""; 
    var isDNI = true;

    for ( i=0; i<tmpString.length; i++ ) {
    
        let tmpNumber = tmpString.charCodeAt(i);
    
        if ( tmpNumber >= 48 && tmpNumber <= 57 ) { 

            theValueString += tmpString.charAt(i); 
  
        } else if ( i == 0 ) {
        
            isDNI = false;

            var theNIEValue = tmpString.charAt(i).toUpperCase().charCodeAt(0) - 88;

        }

    }

    var theNumber = parseInt ( theValueString );

    if (!isDNI) { theNumber += theNIEValue; }

    return { number: theNumber, control: getControlDNI( theNumber ), isdni: isDNI };

}

function getControlDNI ( theNumber ) {

// Control DNI Español: se divide el número entre 23 y el resto se sustituye por una letra que se determina por inspección mediante la siguiente tabla: 0:T, 1:R, 2:W, 3:A, 4:G, 5:M, 6:Y, 7:F, 8:P, 9:D, 10:X, 11:B, 12:N,	13:J,	14:Z,	15:S,	16:Q,	17:V,	18:H,	19:L,	20:C,	21:K,	22:E
// Control NIE Español: os NIE's de extranjeros residentes en España tienen una letra (X, Y, Z), 7 números y dígito de control.
// Para el cálculo del dígito de control se sustituye: X:0, Y:1, Z:2 y se aplica el mismo algoritmo que para el NIF.

var control = theNumber % 23;

var controlAry = ['T','R','W','A','G','M','Y','F','P','D','X','B','N','J','Z','S','Q','V','H','L','C','K','E'];

return controlAry[control];

}

// - - - - - - - - - controlDNI( theDocument ) - Gerenra control de documento: caracter, tipo y numero //

</script>